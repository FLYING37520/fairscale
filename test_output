============================= test session starts ==============================
platform linux -- Python 3.9.5, pytest-5.4.1, py-1.10.0, pluggy-0.13.1 -- /private/home/anupamb/miniconda3/bin/python
cachedir: .pytest_cache
rootdir: /private/home/anupamb/github/fairscale, inifile: setup.cfg
plugins: timeout-1.4.2, cov-2.10.0, pudb-0.7.0
collecting ... collected 1 item

tests/nn/data_parallel/test_fsdp.py::TestComparisonToPyTorchDDP::test_cpu_offload_and_cpu_grads dist init r=0, world=1
<class 'torch.nn.parallel.distributed.DistributedDataParallel'>
ref_loss is tensor(11.0767, device='cuda:0')
<class 'fairscale.nn.data_parallel.fully_sharded_data_parallel.FullyShardedDataParallel'>
{'stage': <OptState.UNSCALED: 1>, 'found_inf_per_device': {device(type='cpu'): tensor([0.])}}
tensor([0.]) cpu
{'stage': <OptState.UNSCALED: 1>, 'found_inf_per_device': {device(type='cpu'): tensor([0.])}}
tensor([0.]) cpu
shard_loss tensor([nan], device='cuda:0')
dist init r=0, world=2
<class 'torch.nn.parallel.distributed.DistributedDataParallel'>
ref_loss is tensor(11.1073, device='cuda:0')
<class 'fairscale.nn.data_parallel.fully_sharded_data_parallel.FullyShardedDataParallel'>
{'stage': <OptState.UNSCALED: 1>, 'found_inf_per_device': {device(type='cpu'): tensor([0.])}}
tensor([0.]) cpu
{'stage': <OptState.UNSCALED: 1>, 'found_inf_per_device': {device(type='cpu'): tensor([0.])}}
tensor([0.]) cpu
shard_loss tensor([nan], device='cuda:0')
dist init r=1, world=2
<class 'torch.nn.parallel.distributed.DistributedDataParallel'>
ref_loss is tensor(10.8638, device='cuda:1')
<class 'fairscale.nn.data_parallel.fully_sharded_data_parallel.FullyShardedDataParallel'>
{'stage': <OptState.UNSCALED: 1>, 'found_inf_per_device': {device(type='cpu'): tensor([0.])}}
tensor([0.]) cpu
{'stage': <OptState.UNSCALED: 1>, 'found_inf_per_device': {device(type='cpu'): tensor([0.])}}
tensor([0.]) cpu
shard_loss tensor([nan], device='cuda:1')
PASSED

============================== 1 passed in 10.33s ==============================
